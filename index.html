<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Break Depo - Bizdev</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        input:focus, select:focus { outline: none; border-color: #0f172a !important; background-color: white !important; }
        .btn-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="text-slate-800">

    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl flex flex-col relative overflow-hidden">
        
        <!-- HEADER -->
        <header class="bg-gradient-to-br from-slate-900 to-black text-white p-5 sticky top-0 z-50 shadow-lg">
            <div class="flex items-center gap-4">
                <div id="backBtn" class="hidden cursor-pointer p-2 hover:bg-white/10 rounded-full transition" onclick="toggleView('calc')">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="w-10 h-10 border-2 border-white rounded-full flex items-center justify-center font-black text-xs shrink-0">BD</div>
                <div class="flex-1">
                    <h1 id="headerTitle" class="text-base font-bold leading-none">Kalkulator Break Depo</h1>
                    <p class="text-[8px] opacity-50 tracking-widest mt-1 uppercase">Bizdev Bank WM</p>
                </div>
                <div class="cursor-pointer p-2 bg-white/10 rounded-lg hover:bg-white/20 transition" onclick="toggleView('history')">
                    <i id="navIcon" class="fas fa-history"></i>
                </div>
            </div>
        </header>

        <div id="content" class="flex-1 overflow-y-auto">
            <!-- VIEW: KALKULATOR -->
            <div id="calcView" class="p-6 space-y-6 fade-in">
                <div class="space-y-4">
                    <!-- Nominal Deposito -->
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Nominal Deposito</label>
                        <div class="relative">
                            <span class="absolute left-4 top-3.5 font-bold text-slate-400">Rp</span>
                            <input type="text" id="nominal" oninput="formatInput(this)" class="w-full pl-10 pr-4 py-3 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold transition placeholder-slate-300" placeholder="0">
                        </div>
                    </div>

                    <!-- Tanggal -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Tanggal Tanam</label>
                            <input type="date" id="tglTanam" class="w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-sm outline-none">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Tanggal Break</label>
                            <input type="date" id="tglBreak" class="w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-sm outline-none">
                        </div>
                    </div>

                    <!-- Tenor -->
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Tenor Kontrak Awal</label>
                        <select id="tenor" class="w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-sm outline-none">
                            <option value="">Pilih Tenor</option>
                            <option value="1">1 Bulan</option>
                            <option value="3">3 Bulan</option>
                            <option value="6">6 Bulan</option>
                            <option value="12">12 Bulan</option>
                            <option value="24">24 Bulan</option>
                            <option value="36">36 Bulan</option>
                            <option value="60">60 Bulan</option>
                        </select>
                    </div>

                    <!-- Pencairan Re-Invest Section -->
                    <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100 space-y-3 transition-all duration-300">
                        <div class="flex items-center gap-3 cursor-pointer" onclick="toggleReinvest()">
                            <div id="checkReinvest" class="w-6 h-6 rounded-md border-2 bg-white border-slate-300 transition flex items-center justify-center text-white text-[12px]">âœ“</div>
                            <span class="text-sm font-bold text-slate-700">Pencairan Re-Invest</span>
                        </div>

                        <div id="reinvestOptions" class="hidden space-y-4 pt-3 border-t border-slate-200 animate-in">
                            <div class="flex gap-6 px-1">
                                <label class="flex items-center gap-2 cursor-pointer text-xs font-semibold">
                                    <input type="radio" name="reType" value="all" checked onclick="handleReType('all')" class="w-4 h-4 accent-slate-900"> Seluruhnya
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer text-xs font-semibold">
                                    <input type="radio" name="reType" value="partial" onclick="handleReType('partial')" class="w-4 h-4 accent-slate-900"> Sebagian
                                </label>
                            </div>
                            <div id="partialInput" class="hidden space-y-1">
                                <div class="relative">
                                    <span class="absolute left-3 top-2.5 font-bold text-slate-400 text-xs">Rp</span>
                                    <input type="text" id="nominalReinvest" oninput="formatInput(this)" class="w-full pl-8 pr-4 py-2 bg-white border-2 border-slate-200 rounded-xl text-xs font-bold" placeholder="Nominal Baru">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 pt-2">
                    <button onclick="resetApp()" class="py-4 bg-slate-100 text-slate-500 font-bold rounded-2xl hover:bg-slate-200 transition text-sm uppercase">Reset</button>
                    <button onclick="calculate()" class="py-4 bg-slate-900 text-white font-bold rounded-2xl hover:bg-black transition btn-shadow text-sm uppercase tracking-wide">Hitung Break</button>
                </div>

                <!-- HASIL -->
                <div id="resultCard" class="hidden bg-white rounded-3xl p-6 border-2 border-slate-100 shadow-xl space-y-6 fade-in">
                    <div class="text-center">
                        <p class="text-[10px] font-bold text-slate-400 uppercase">Dana Diterima (Estimasi)</p>
                        <h2 id="resTotal" class="text-3xl font-black text-slate-900">Rp 0</h2>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm"><span class="text-slate-500 font-medium">Umur Deposito</span><span id="resUmur" class="font-bold">-</span></div>
                        <div class="flex justify-between text-sm text-red-500"><span id="penaltyLabel" class="font-medium">Denda Penalty (0,1%)</span><span id="resPenalty" class="font-bold">-</span></div>
                        <div class="flex justify-between text-sm text-red-500 border-b border-slate-100 pb-3">
                            <span class="font-medium">Kelebihan Bunga</span>
                            <div class="flex flex-col items-end">
                                <span id="resReversal" class="font-bold">-</span>
                                <button id="detailToggleBtn" onclick="toggleDetails()" class="text-[10px] text-blue-600 font-bold mt-1 underline hover:text-blue-800">Lihat Rincian</button>
                            </div>
                        </div>
                        
                        <!-- Rincian Dropdown -->
                        <div id="details" class="hidden p-4 bg-slate-50/50 rounded-2xl text-[11px] space-y-3 border border-slate-100 fade-in">
                            <div class="flex items-start gap-2 p-2 bg-blue-50 text-blue-800 rounded-lg font-bold border border-blue-100 leading-tight">
                                <i class="fas fa-info-circle text-[10px] mt-0.5"></i>
                                <div class="flex flex-col">
                                    <span class="text-[9px]">Memo Suku Bunga Depo:</span>
                                    <span id="detMemo" class="text-[10px]">Berlaku -</span>
                                </div>
                            </div>
                            <div class="flex justify-between text-slate-600"><span>Bunga Kontrak <span id="detRateOldP"></span></span><span id="detRateOld" class="font-bold text-slate-800">-</span></div>
                            <div class="flex justify-between text-slate-600"><span>Bunga Riil <span id="detRateNewP"></span></span><span id="detRateNew" class="font-bold text-slate-800">-</span></div>
                            <div class="flex justify-between pt-2 border-t border-slate-200 font-bold">
                                <span class="text-slate-900">Total Selisih</span>
                                <span id="detTotalDiff" class="text-red-500">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: HISTORY -->
            <div id="historyView" class="hidden p-6 space-y-4 fade-in">
                <div class="p-4 bg-blue-50 text-blue-700 rounded-xl flex gap-3 items-start border border-blue-100 shadow-sm">
                    <i class="fas fa-info-circle mt-1"></i>
                    <p class="text-[11px] leading-relaxed font-medium">Data histori memo suku bunga di bawah ini digunakan untuk perhitungan otomatis berdasarkan Tanggal Tanam deposito Anda.</p>
                </div>
                <div id="historyList" class="space-y-3"></div>
            </div>
        </div>

        <!-- FOOTER -->
        <footer class="p-6 text-center bg-white border-t border-slate-50 flex flex-col items-center gap-1">
            <div class="flex items-center gap-2 opacity-30 group hover:opacity-100 transition-opacity duration-500">
                <div class="w-6 h-6 border-2 border-slate-900 rounded-full flex items-center justify-center font-black text-[8px] shrink-0">BD</div>
                <div class="text-xs font-black tracking-tighter text-slate-900 uppercase">Bizdev Bank WM</div>
        </footer>
    </div>

    <script>
        /** * DATA BUNGA INTERNAL (Lengkap 11 Memo)
         */
        const DATA_MEMO_BUNGA = [
            { date: "2025-08-28", rates: { 1: 4.5, 3: 4.75, 6: 5.25, 12: 5.5, 24: 6.5, 36: 7.0, 60: 8.25 } },
            { date: "2023-02-01", rates: { 1: 4.75, 3: 5.0, 6: 5.5, 12: 5.75, 24: 6.75, 36: 7.25, 60: 8.5 } },
            { date: "2021-09-30", rates: { 1: 4.5, 3: 4.75, 6: 5.25, 12: 5.5, 24: 6.5, 36: 7.0, 60: 8.25 } },
            { date: "2021-05-29", rates: { 1: 4.75, 3: 5.0, 6: 5.5, 12: 5.75, 24: 6.75, 36: 7.25, 60: 8.25 } },
            { date: "2021-05-01", rates: { 1: 5.0, 3: 5.25, 6: 5.75, 12: 6.0, 24: 7.0, 36: 7.5, 60: 8.25 } },
            { date: "2021-02-25", rates: { 1: 5.25, 3: 5.5, 6: 5.75, 12: 6.0, 24: 7.0, 36: 7.5, 60: 8.25 } },
            { date: "2021-01-26", rates: { 1: 5.5, 3: 5.75, 6: 6.0, 12: 6.25, 24: 7.25, 36: 7.75, 60: 8.25 } },
            { date: "2020-11-25", rates: { 1: 5.5, 3: 6.0, 6: 6.25, 12: 6.5, 24: 7.25, 36: 7.75, 60: 8.25 } },
            { date: "2020-10-01", rates: { 1: 6.0, 3: 6.5, 6: 6.75, 12: 7.0, 24: 7.75, 36: 8.25, 60: 8.75 } },
            { date: "2020-07-30", rates: { 1: 6.25, 3: 6.75, 6: 7.0, 12: 7.25, 24: 8.0, 36: 8.25, 60: 8.75 } },
            { date: "2020-01-29", rates: { 1: 6.5, 3: 7.0, 6: 7.25, 12: 7.5, 24: 8.0, 36: 8.25, 60: 8.75 } }
        ];

        let isReinvest = false;
        let reType = 'all';
        const TENORS = [1, 3, 6, 12, 24, 36, 60];

        function formatInput(el) {
            let val = el.value.replace(/\D/g, "");
            el.value = val.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function toggleReinvest() {
            isReinvest = !isReinvest;
            const box = document.getElementById('checkReinvest');
            const opt = document.getElementById('reinvestOptions');
            if (isReinvest) {
                box.classList.replace('bg-white', 'bg-slate-900');
                box.classList.replace('border-slate-300', 'border-slate-900');
                opt.classList.remove('hidden');
            } else {
                box.classList.replace('bg-slate-900', 'bg-white');
                box.classList.replace('border-slate-900', 'border-slate-300');
                opt.classList.add('hidden');
            }
        }

        function handleReType(type) {
            reType = type;
            document.getElementById('partialInput').classList.toggle('hidden', type !== 'partial');
        }

        function toggleView(view) {
            const calc = document.getElementById('calcView');
            const history = document.getElementById('historyView');
            const backBtn = document.getElementById('backBtn');
            const title = document.getElementById('headerTitle');
            const navIcon = document.getElementById('navIcon');

            if (view === 'history') {
                calc.classList.add('hidden');
                history.classList.remove('hidden');
                backBtn.classList.remove('hidden');
                title.innerText = 'Histori Memo';
                navIcon.className = 'fas fa-calculator';
                renderHistory();
            } else {
                calc.classList.remove('hidden');
                history.classList.add('hidden');
                backBtn.classList.add('hidden');
                title.innerText = 'Kalkulator Break Depo';
                navIcon.className = 'fas fa-history';
            }
        }

        function toggleDetails() {
            const details = document.getElementById('details');
            const btn = document.getElementById('detailToggleBtn');
            details.classList.toggle('hidden');
            btn.innerText = details.classList.contains('hidden') ? 'Lihat Rincian' : 'Tutup Rincian';
        }

        function formatRupiah(num) {
            return 'Rp ' + Math.round(num).toLocaleString('id-ID');
        }

        function formatDateReadable(dateStr) {
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return new Date(dateStr).toLocaleDateString('id-ID', options);
        }

        function resetApp() {
            document.getElementById('nominal').value = '';
            document.getElementById('tenor').value = '';
            document.getElementById('tglTanam').value = '';
            document.getElementById('nominalReinvest').value = '';
            document.getElementById('resultCard').classList.add('hidden');
            if(isReinvest) toggleReinvest();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function calculate() {
            const nominalStr = document.getElementById('nominal').value;
            const tenor = document.getElementById('tenor').value;
            const tglTanamStr = document.getElementById('tglTanam').value;
            const tglBreakStr = document.getElementById('tglBreak').value;

            if (!nominalStr || !tenor || !tglTanamStr) {
                return alert("Mohon lengkapi Nominal, Tenor, dan Tanggal Tanam!");
            }

            const nominal = parseFloat(nominalStr.replace(/\./g, '')) || 0;
            const start = new Date(tglTanamStr);
            const end = new Date(tglBreakStr);

            if (end <= start) return alert("Tanggal Break tidak boleh sebelum/sama dengan Tanggal Tanam!");

            // Umur Deposito
            const diffDays = Math.ceil(Math.abs(end - start) / (1000 * 60 * 60 * 24));
            let monthsPassed = (end.getFullYear() - start.getFullYear()) * 12 + (end.getMonth() - start.getMonth());
            if (end.getDate() < start.getDate()) monthsPassed--;
            monthsPassed = Math.max(0, monthsPassed);

            // Cari Memo Suku Bunga (Sort Desc)
            const sorted = [...DATA_MEMO_BUNGA].sort((a, b) => new Date(b.date) - new Date(a.date));
            const activeIdx = sorted.findIndex(m => new Date(m.date) <= start);
            if (activeIdx === -1) return alert("Data bunga tidak ditemukan untuk tanggal tanam tersebut.");

            const activeMemo = sorted[activeIdx];
            
            // Label Periode
            let memoLabel = "";
            const tglMulai = formatDateReadable(activeMemo.date);
            if (activeIdx === 0) {
                memoLabel = `Berlaku ${tglMulai} s/d Sekarang`;
            } else {
                const nextDate = new Date(sorted[activeIdx - 1].date);
                nextDate.setDate(nextDate.getDate() - 1);
                memoLabel = `Berlaku ${tglMulai} s/d ${formatDateReadable(nextDate.toISOString().split('T')[0])}`;
            }

            // Hitung Rate
            const rateKontrak = activeMemo.rates[tenor] || 0;
            let rateAktual = 0;
            if (monthsPassed >= 1) {
                const sortedTenors = [...TENORS].sort((a, b) => b - a);
                for (let t of sortedTenors) {
                    if (monthsPassed >= t) {
                        rateAktual = activeMemo.rates[t] || 0;
                        break;
                    }
                }
            }

            // Hitung Denda Penalty
            let penalty = 0;
            if (isReinvest) {
                if (reType === 'all') {
                    penalty = 0;
                    document.getElementById('penaltyLabel').innerText = "Denda Penalty (Tanam Kembali)";
                } else {
                    const reNominalStr = document.getElementById('nominalReinvest').value;
                    const reNominal = parseFloat(reNominalStr.replace(/\./g, '')) || 0;
                    const sisa = Math.max(0, nominal - reNominal);
                    penalty = sisa * 0.001;
                    document.getElementById('penaltyLabel').innerText = "Denda Penalty (0,1% dr sisa)";
                }
            } else {
                penalty = nominal * 0.001;
                document.getElementById('penaltyLabel').innerText = "Denda Penalty (0,1%)";
            }

            // Hitung Reversal
            const bungaOldPerBln = nominal * (rateKontrak / 100 / 12);
            const bungaNewPerBln = nominal * (rateAktual / 100 / 12);
            const reversal = monthsPassed >= 1 ? (bungaOldPerBln - bungaNewPerBln) * monthsPassed : 0;
            const totalReceived = nominal - penalty - reversal;

            // Update UI
            document.getElementById('resTotal').innerText = formatRupiah(totalReceived);
            document.getElementById('resUmur').innerText = `${monthsPassed} Bulan (${diffDays} Hari)`;
            document.getElementById('resPenalty').innerText = "-" + formatRupiah(penalty);
            document.getElementById('resReversal').innerText = "-" + formatRupiah(reversal);
            
            document.getElementById('detMemo').innerText = memoLabel;
            document.getElementById('detRateOldP').innerText = `(${rateKontrak}%)`;
            document.getElementById('detRateNewP').innerText = `(${rateAktual}%)`;
            document.getElementById('detRateOld').innerText = `${formatRupiah(bungaOldPerBln)} /bln`;
            document.getElementById('detRateNew').innerText = `${formatRupiah(bungaNewPerBln)} /bln`;
            document.getElementById('detTotalDiff').innerText = `${formatRupiah(reversal)} (${monthsPassed} bln)`;

            document.getElementById('resultCard').classList.remove('hidden');
            document.getElementById('details').classList.add('hidden');
            document.getElementById('detailToggleBtn').innerText = 'Lihat Rincian';
            document.getElementById('resultCard').scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            const sorted = [...DATA_MEMO_BUNGA].sort((a, b) => new Date(b.date) - new Date(a.date));

            sorted.forEach((memo, idx) => {
                const tglMulai = formatDateReadable(memo.date);
                let label = "";
                if (idx === 0) {
                    label = `Berlaku ${tglMulai} s/d Sekarang`;
                } else {
                    const nextDate = new Date(sorted[idx - 1].date);
                    nextDate.setDate(nextDate.getDate() - 1);
                    label = `Berlaku ${tglMulai} s/d ${formatDateReadable(nextDate.toISOString().split('T')[0])}`;
                }

                let ratesHtml = '';
                Object.entries(memo.rates).forEach(([t, r]) => {
                    ratesHtml += `<div class="bg-slate-50 p-2 rounded-lg text-center border border-slate-100"><p class="text-[8px] text-slate-400 font-bold">${t}m</p><p class="text-[10px] font-black">${r}%</p></div>`;
                });

                list.innerHTML += `
                    <div class="p-4 bg-white border-2 border-slate-100 rounded-2xl space-y-3">
                        <div class="border-b border-slate-50 pb-2">
                            <span class="text-[9px] font-black text-slate-900 uppercase tracking-tight leading-none">${label}</span>
                        </div>
                        <div class="grid grid-cols-4 gap-2">${ratesHtml}</div>
                    </div>
                `;
            });
        }

        window.onload = () => {
            document.getElementById('tglBreak').value = new Date().toISOString().split('T')[0];
        };
    </script>
</body>
</html>
